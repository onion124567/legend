
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Game.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '4e12fLSQu1L+KV6QmxDiavU', 'Game');
// scripts/Game.js

"use strict";

exports.__esModule = true;
exports.gameHero = exports.StatusType = void 0;

var _CardBean = _interopRequireDefault(require("./beans/CardBean"));

var _RoleBean = _interopRequireDefault(require("./beans/RoleBean"));

var _Director = _interopRequireDefault(require("./Director"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var PokerUtil = require("PokerUtil");

var AIHelper = require("AIHelper");

var self;
var StatusType = {
  ENCOUNTER: 0,
  //遭遇
  ROUNDBEGIN: 1,
  //回合开始
  ROUNDOVER: -1,
  //回合结束
  CLEAR: -2,
  //战斗结束
  DRAW: 2,
  SEND: 3,
  //出牌
  LOSE: 4,
  //弃牌
  ATTACK: 5,
  //攻击时触发
  UNDERATTACK: 6 //被攻击时触发

};
exports.StatusType = StatusType;
var gameHero = null;
exports.gameHero = gameHero;
var totalCardNum = 5;
/**
 * 战斗界面 demo版本，做一个抽卡，每张卡能打3点血，敌方有20点血的demo
 */

cc.Class({
  "extends": cc.Component,
  properties: {
    logs: {
      "default": null,
      type: cc.Label
    },
    menuView: {
      "default": null,
      type: cc.Button
    },
    coinValueView: {
      "default": null,
      type: cc.Label
    },
    cardPrefab: {
      "default": null,
      type: cc.Prefab
    },
    cardArrays: {
      "default": null,
      type: cc.Layout
    },
    sendBtn: {
      "default": null,
      type: cc.Button
    },
    roundOverBtn: {
      "default": null,
      type: cc.Button
    },
    roundType: StatusType.ROUNDBEGIN,
    hero: {
      "default": null,
      type: cc.Node
    },
    enemy: {
      "default": null,
      type: cc.Node
    },
    enemyCardLabel: {
      "default": null,
      type: cc.Label
    },
    currentCard: null,
    //玩家当前选中的卡片
    enemyCardArrays: [],
    //敌人卡牌
    roundSide: 1,
    //回合轮次
    roundCount: 0
  },
  onLoad: function onLoad() {
    self = this;
    this.playLog = "游戏开始";
    this.roundOverBtn.node.on("click", this.roundOver, this);
    this.sendBtn.node.on("click", this.sendCard, this);
    this.gameEncounter(); // 这里的 this 指向 component
  },
  drawAICard: function drawAICard() {
    var cardBean = new _CardBean["default"]();
    self.enemyRole.onDrawCard(cardBean);
    self.enemyCardArrays.push(cardBean);
  },
  //玩家抽牌
  drawCard: function drawCard() {
    var newCard = cc.instantiate(self.cardPrefab); // newStar.setPicNum("i"+i);

    var card = newCard.getComponent('Card');
    var cardBean = new _CardBean["default"]();
    self.heroRole.onDrawCard(cardBean);
    card.bindCardBean(cardBean);
    card.bindCardFunction(this.onCheck);
    self.cardArrays.node.addChild(newCard);
  },
  onCheck: function onCheck(card, isCheck) {
    if (isCheck) {
      //选中
      if (self.currentCard != null) {
        self.currentCard.onCancel();
      }

      self.currentCard = card;
    } else {
      self.currentCard = null;
    }
  },

  /**
   * 判断牌是否能出
   * 判断知否是指向性牌
   *
   */
  sendCard: function sendCard() {
    if (self.roundSide !== 1) {
      //敌方回合 胜利 不能出牌
      return;
    }

    if (self.currentCard != null) {
      var card = self.currentCard.node.getComponent("Card");
      var cardBean = card.getCardBean();
      self.sendFocusShow(cardBean);
      var value = cardBean.sendEffect(); //造成的伤害值

      self.appendLog("对方受到伤害" + value); //攻击时的伤害值加强或减弱

      value = self.heroRole.attack(value); //

      this.sideUnderAttack(self.enemyRole, null, null, value); //状态调整或附加

      var live = self.enemyRole.isAlive();
      self.currentCard.node.destroy();
      self.currentCard = null;

      if (!live) {
        self.roundSide = -1;
        self.appendLog("敌人死亡 游戏胜利");
        self.toMapScene();
      }
    }
  },

  /**先判定目标
   * 根据状态承受伤害
   * 宝宝死亡时销毁节点
   */
  sideUnderAttack: function sideUnderAttack(role, pokemonleft, pokenmonright, value) {},
  sendFocusShow: function sendFocusShow(cardBean) {
    self.appendLog("出牌" + cardBean.title);
  },
  roundOver: function roundOver() {
    if (self.roundSide !== 1) {
      //敌方回合 胜利 不能出牌
      return;
    }

    self.appendLog("回合结束");
    this.roundProgram(0);
  },
  gameEncounter: function gameEncounter() {
    var _this = this;

    var hero = new _RoleBean["default"](1);
    var enemy = new _RoleBean["default"](0);
    this.enemyRole = this.enemy.getComponent('Role');
    this.enemyRole.bindRoleBean(enemy);
    this.heroRole = this.hero.getComponent('Role');
    this.heroRole.bindRoleBean(hero);
    this.scheduleOnce(function () {
      return _this.roundProgram(1);
    }, 1);
  },

  /**
   * 每回合的执行顺序
   */
  roundProgram: function roundProgram(rolettype) {
    var number = 0;
    this.roundSide = rolettype;

    if (rolettype === 1) {
      self.appendLog("你的回合");
      this.roundCount++;
      this.heroRole.roundBegin();
      number = self.cardArrays.node.childrenCount; //抽卡直到手牌抽满

      self.appendLog("你抽牌");

      for (var i = 0; i < totalCardNum - number; i++) {
        this.drawCard();
      } //等待出牌

    } else {
      self.appendLog("对方回合");
      this.enemyRole.roundBegin();
      number = self.enemyCardArrays.length;
      self.appendLog("对方抽牌"); //调用ai抽牌

      for (var _i = 0; _i < totalCardNum - number; _i++) {
        this.drawAICard();
      }

      this.enemyCardLabel.string = self.enemyCardArrays.length + "张";
      this.logicAI();
    }
  },
  //AI出牌逻辑
  logicAI: function logicAI() {
    for (var i = 0; i < self.enemyCardArrays.length;) {
      var cardBean = self.enemyCardArrays[i];
      var canSend = true;

      if (canSend) {
        self.enemyCardArrays.splice(i, 1);
        var value = cardBean.sendEffect();
        value = self.enemyRole.attack(value);
        self.appendLog("你受到伤害" + value);
        self.sendFocusShow(cardBean);
        var live = self.heroRole.underattack(value);

        if (!live) {
          self.appendLog("英雄死亡 游戏结束");
          self.roundSide = -1;
          return;
        }

        this.enemyCardLabel.string = self.enemyCardArrays.length + "张";
        self.scheduleOnce(function () {
          return self.logicAI();
        }, 1);
        return;
      } else {
        i++;
      }
    }

    self.enemyRole.roundOver();
    self.roundProgram(1);
  },
  //     move:function(node,distance){
  //         // 创建一个移动动作
  //         let seq = cc.repeat(
  //             cc.sequence(
  //                 cc.moveBy(2,  -distance, 50),
  //                 cc.moveBy(2,distance, -50)
  //             ), 2);
  //
  //
  // // 执行动作
  //         node.runAction(seq);
  // // 停止一个动作
  // //         node.stopAction(action);
  //     },

  /**
   * 切换至地图
   */
  toMapScene: function toMapScene() {
    this.saveHeroData();
    _Director["default"].currentEnemy = null;
    cc.director.loadScene('outermap');
  },
  saveHeroData: function saveHeroData() {
    if (self.heroRole.roleHp <= _Director["default"].hostHero.fullhp) {
      _Director["default"].hostHero.hp = self.heroRole.roleHp;
    } else {
      _Director["default"].hostHero.hp = _Director["default"].hostHero.fullhp;
    }
  },
  appendLog: function appendLog(string) {
    self.playLog = self.playLog + "\n" + string;
    self.logs.string = self.playLog;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL0dhbWUuanMiXSwibmFtZXMiOlsiUG9rZXJVdGlsIiwicmVxdWlyZSIsIkFJSGVscGVyIiwic2VsZiIsIlN0YXR1c1R5cGUiLCJFTkNPVU5URVIiLCJST1VOREJFR0lOIiwiUk9VTkRPVkVSIiwiQ0xFQVIiLCJEUkFXIiwiU0VORCIsIkxPU0UiLCJBVFRBQ0siLCJVTkRFUkFUVEFDSyIsImdhbWVIZXJvIiwidG90YWxDYXJkTnVtIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJsb2dzIiwidHlwZSIsIkxhYmVsIiwibWVudVZpZXciLCJCdXR0b24iLCJjb2luVmFsdWVWaWV3IiwiY2FyZFByZWZhYiIsIlByZWZhYiIsImNhcmRBcnJheXMiLCJMYXlvdXQiLCJzZW5kQnRuIiwicm91bmRPdmVyQnRuIiwicm91bmRUeXBlIiwiaGVybyIsIk5vZGUiLCJlbmVteSIsImVuZW15Q2FyZExhYmVsIiwiY3VycmVudENhcmQiLCJlbmVteUNhcmRBcnJheXMiLCJyb3VuZFNpZGUiLCJyb3VuZENvdW50Iiwib25Mb2FkIiwicGxheUxvZyIsIm5vZGUiLCJvbiIsInJvdW5kT3ZlciIsInNlbmRDYXJkIiwiZ2FtZUVuY291bnRlciIsImRyYXdBSUNhcmQiLCJjYXJkQmVhbiIsIkNhcmRCZWFuIiwiZW5lbXlSb2xlIiwib25EcmF3Q2FyZCIsInB1c2giLCJkcmF3Q2FyZCIsIm5ld0NhcmQiLCJpbnN0YW50aWF0ZSIsImNhcmQiLCJnZXRDb21wb25lbnQiLCJoZXJvUm9sZSIsImJpbmRDYXJkQmVhbiIsImJpbmRDYXJkRnVuY3Rpb24iLCJvbkNoZWNrIiwiYWRkQ2hpbGQiLCJpc0NoZWNrIiwib25DYW5jZWwiLCJnZXRDYXJkQmVhbiIsInNlbmRGb2N1c1Nob3ciLCJ2YWx1ZSIsInNlbmRFZmZlY3QiLCJhcHBlbmRMb2ciLCJhdHRhY2siLCJzaWRlVW5kZXJBdHRhY2siLCJsaXZlIiwiaXNBbGl2ZSIsImRlc3Ryb3kiLCJ0b01hcFNjZW5lIiwicm9sZSIsInBva2Vtb25sZWZ0IiwicG9rZW5tb25yaWdodCIsInRpdGxlIiwicm91bmRQcm9ncmFtIiwiUm9sZUJlYW4iLCJiaW5kUm9sZUJlYW4iLCJzY2hlZHVsZU9uY2UiLCJyb2xldHR5cGUiLCJudW1iZXIiLCJyb3VuZEJlZ2luIiwiY2hpbGRyZW5Db3VudCIsImkiLCJsZW5ndGgiLCJzdHJpbmciLCJsb2dpY0FJIiwiY2FuU2VuZCIsInNwbGljZSIsInVuZGVyYXR0YWNrIiwic2F2ZUhlcm9EYXRhIiwiRGlyZWN0b3IiLCJjdXJyZW50RW5lbXkiLCJkaXJlY3RvciIsImxvYWRTY2VuZSIsInJvbGVIcCIsImhvc3RIZXJvIiwiZnVsbGhwIiwiaHAiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxJQUFJQSxTQUFTLEdBQUdDLE9BQU8sQ0FBQyxXQUFELENBQXZCOztBQUNBLElBQUlDLFFBQVEsR0FBR0QsT0FBTyxDQUFDLFVBQUQsQ0FBdEI7O0FBQ0EsSUFBSUUsSUFBSjtBQUNPLElBQUlDLFVBQVUsR0FBRztBQUNwQkMsRUFBQUEsU0FBUyxFQUFFLENBRFM7QUFDUDtBQUNiQyxFQUFBQSxVQUFVLEVBQUUsQ0FGUTtBQUVOO0FBQ2RDLEVBQUFBLFNBQVMsRUFBRSxDQUFDLENBSFE7QUFHTjtBQUNkQyxFQUFBQSxLQUFLLEVBQUUsQ0FBQyxDQUpZO0FBSVY7QUFDVkMsRUFBQUEsSUFBSSxFQUFDLENBTGU7QUFNcEJDLEVBQUFBLElBQUksRUFBRSxDQU5jO0FBTVo7QUFDUkMsRUFBQUEsSUFBSSxFQUFFLENBUGM7QUFPWjtBQUNSQyxFQUFBQSxNQUFNLEVBQUUsQ0FSWTtBQVFWO0FBQ1ZDLEVBQUFBLFdBQVcsRUFBRSxDQVRPLENBU0w7O0FBVEssQ0FBakI7O0FBV0EsSUFBSUMsUUFBUSxHQUFDLElBQWI7O0FBQ1AsSUFBSUMsWUFBWSxHQUFHLENBQW5CO0FBQ0E7Ozs7QUFHQUMsRUFBRSxDQUFDQyxLQUFILENBQVM7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QUFTSyxRQUFULENBQWtCRSxFQUFsQixHQUFxQnJHLElBQUksQ0FBQ3dELFFBQUwsQ0FBYzBDLE1BQW5DO0FBQ0gsS0FGRCxNQUVNO0FBQ0ZKLDJCQUFTSyxRQUFULENBQWtCRSxFQUFsQixHQUFxQlAscUJBQVNLLFFBQVQsQ0FBa0JDLE1BQXZDO0FBQ0g7QUFDSixHQXBQSTtBQXFQTGpDLEVBQUFBLFNBQVMsRUFBRSxtQkFBVXFCLE1BQVYsRUFBa0I7QUFDekJ4RixJQUFBQSxJQUFJLENBQUN1QyxPQUFMLEdBQWV2QyxJQUFJLENBQUN1QyxPQUFMLEdBQWUsSUFBZixHQUFzQmlELE1BQXJDO0FBQ0F4RixJQUFBQSxJQUFJLENBQUNpQixJQUFMLENBQVV1RSxNQUFWLEdBQW1CeEYsSUFBSSxDQUFDdUMsT0FBeEI7QUFFSDtBQXpQSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ2FyZEJlYW4gZnJvbSBcIi4vYmVhbnMvQ2FyZEJlYW5cIjtcbmltcG9ydCBSb2xlQmVhbiBmcm9tIFwiLi9iZWFucy9Sb2xlQmVhblwiO1xuaW1wb3J0IERpcmVjdG9yIGZyb20gXCIuL0RpcmVjdG9yXCI7XG5cbmxldCBQb2tlclV0aWwgPSByZXF1aXJlKFwiUG9rZXJVdGlsXCIpO1xubGV0IEFJSGVscGVyID0gcmVxdWlyZShcIkFJSGVscGVyXCIpO1xubGV0IHNlbGY7XG5leHBvcnQgdmFyIFN0YXR1c1R5cGUgPSB7XG4gICAgRU5DT1VOVEVSOiAwLC8v6YGt6YGHXG4gICAgUk9VTkRCRUdJTjogMSwvL+WbnuWQiOW8gOWni1xuICAgIFJPVU5ET1ZFUjogLTEsLy/lm57lkIjnu5PmnZ9cbiAgICBDTEVBUjogLTIsLy/miJjmlpfnu5PmnZ9cbiAgICBEUkFXOjIsXG4gICAgU0VORDogMywvL+WHuueJjFxuICAgIExPU0U6IDQsLy/lvIPniYxcbiAgICBBVFRBQ0s6IDUsLy/mlLvlh7vml7bop6blj5FcbiAgICBVTkRFUkFUVEFDSzogNiwvL+iiq+aUu+WHu+aXtuinpuWPkVxufVxuZXhwb3J0IHZhciBnYW1lSGVybz1udWxsO1xubGV0IHRvdGFsQ2FyZE51bSA9IDU7XG4vKipcbiAqIOaImOaWl+eVjOmdoiBkZW1v54mI5pys77yM5YGa5LiA5Liq5oq95Y2h77yM5q+P5byg5Y2h6IO95omTM+eCueihgO+8jOaVjOaWueaciTIw54K56KGA55qEZGVtb1xuICovXG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBsb2dzOntcbiAgICAgICAgICAgIGRlZmF1bHQ6bnVsbCxcbiAgICAgICAgICAgIHR5cGU6Y2MuTGFiZWwsXG4gICAgICAgIH0sXG5cbiAgICAgICAgbWVudVZpZXc6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5CdXR0b24sXG4gICAgICAgIH0sXG4gICAgICAgIGNvaW5WYWx1ZVZpZXc6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5MYWJlbCxcbiAgICAgICAgfSxcbiAgICAgICAgY2FyZFByZWZhYjoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLlByZWZhYlxuICAgICAgICB9LFxuICAgICAgICBjYXJkQXJyYXlzOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuTGF5b3V0LFxuICAgICAgICB9LFxuICAgICAgICBzZW5kQnRuOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuQnV0dG9uLFxuICAgICAgICB9LFxuICAgICAgICByb3VuZE92ZXJCdG46IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5CdXR0b24sXG4gICAgICAgIH0sXG4gICAgICAgIHJvdW5kVHlwZTogU3RhdHVzVHlwZS5ST1VOREJFR0lOLFxuICAgICAgICBoZXJvOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuTm9kZVxuICAgICAgICB9LFxuICAgICAgICBlbmVteToge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLk5vZGVcbiAgICAgICAgfSxcbiAgICAgICAgZW5lbXlDYXJkTGFiZWw6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5MYWJlbCxcbiAgICAgICAgfSxcblxuICAgICAgICBjdXJyZW50Q2FyZDogbnVsbCwvL+eOqeWutuW9k+WJjemAieS4reeahOWNoeeJh1xuICAgICAgICBlbmVteUNhcmRBcnJheXM6W10sLy/mlYzkurrljaHniYxcbiAgICAgICAgcm91bmRTaWRlOjEsLy/lm57lkIjova7mrKFcbiAgICAgICAgcm91bmRDb3VudDowLFxuXG5cbiAgICB9LFxuXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLnBsYXlMb2c9XCLmuLjmiI/lvIDlp4tcIjtcbiAgICAgICAgdGhpcy5yb3VuZE92ZXJCdG4ubm9kZS5vbihcImNsaWNrXCIsIHRoaXMucm91bmRPdmVyLCB0aGlzKTtcbiAgICAgICAgdGhpcy5zZW5kQnRuLm5vZGUub24oXCJjbGlja1wiLCB0aGlzLnNlbmRDYXJkLCB0aGlzKTtcbiAgICAgICAgdGhpcy5nYW1lRW5jb3VudGVyKCk7XG4gICAgICAgIC8vIOi/memHjOeahCB0aGlzIOaMh+WQkSBjb21wb25lbnRcbiAgICB9LFxuICAgIGRyYXdBSUNhcmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IGNhcmRCZWFuPW5ldyBDYXJkQmVhbigpO1xuICAgICAgICBzZWxmLmVuZW15Um9sZS5vbkRyYXdDYXJkKGNhcmRCZWFuKTtcbiAgICAgICAgc2VsZi5lbmVteUNhcmRBcnJheXMucHVzaChjYXJkQmVhbik7XG5cbiAgICB9LFxuICAgIC8v546p5a625oq954mMXG4gICAgZHJhd0NhcmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgbGV0IG5ld0NhcmQgPSBjYy5pbnN0YW50aWF0ZShzZWxmLmNhcmRQcmVmYWIpO1xuICAgICAgICAvLyBuZXdTdGFyLnNldFBpY051bShcImlcIitpKTtcblxuICAgICAgICBsZXQgY2FyZCA9IG5ld0NhcmQuZ2V0Q29tcG9uZW50KCdDYXJkJyk7XG4gICAgICAgIGxldCBjYXJkQmVhbj1uZXcgQ2FyZEJlYW4oKTtcbiAgICAgICAgc2VsZi5oZXJvUm9sZS5vbkRyYXdDYXJkKGNhcmRCZWFuKTtcbiAgICAgICAgY2FyZC5iaW5kQ2FyZEJlYW4oY2FyZEJlYW4pO1xuICAgICAgICBjYXJkLmJpbmRDYXJkRnVuY3Rpb24odGhpcy5vbkNoZWNrKTtcbiAgICAgICAgc2VsZi5jYXJkQXJyYXlzLm5vZGUuYWRkQ2hpbGQobmV3Q2FyZCk7XG4gICAgfSxcbiAgICBvbkNoZWNrOiBmdW5jdGlvbiAoY2FyZCwgaXNDaGVjaykge1xuICAgICAgICBpZiAoaXNDaGVjaykgey8v6YCJ5LitXG4gICAgICAgICAgICBpZiAoc2VsZi5jdXJyZW50Q2FyZCAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5jdXJyZW50Q2FyZC5vbkNhbmNlbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc2VsZi5jdXJyZW50Q2FyZCA9IGNhcmQ7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzZWxmLmN1cnJlbnRDYXJkID0gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDliKTmlq3niYzmmK/lkKbog73lh7pcbiAgICAgKiDliKTmlq3nn6XlkKbmmK/mjIflkJHmgKfniYxcbiAgICAgKlxuICAgICAqL1xuICAgIHNlbmRDYXJkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmKHNlbGYucm91bmRTaWRlIT09MSl7Ly/mlYzmlrnlm57lkIgg6IOc5YipIOS4jeiDveWHuueJjFxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzZWxmLmN1cnJlbnRDYXJkICE9IG51bGwpIHtcbiAgICAgICAgICAgIGxldCBjYXJkID0gc2VsZi5jdXJyZW50Q2FyZC5ub2RlLmdldENvbXBvbmVudChcIkNhcmRcIik7XG4gICAgICAgICAgICBsZXQgY2FyZEJlYW49Y2FyZC5nZXRDYXJkQmVhbigpO1xuICAgICAgICAgICAgc2VsZi5zZW5kRm9jdXNTaG93KGNhcmRCZWFuKTtcbiAgICAgICAgICAgIGxldCB2YWx1ZSA9IGNhcmRCZWFuLnNlbmRFZmZlY3QoKTsvL+mAoOaIkOeahOS8pOWus+WAvFxuICAgICAgICAgICAgc2VsZi5hcHBlbmRMb2coXCLlr7nmlrnlj5fliLDkvKTlrrNcIit2YWx1ZSk7XG4gICAgICAgICAgICAvL+aUu+WHu+aXtueahOS8pOWus+WAvOWKoOW8uuaIluWHj+W8sVxuICAgICAgICAgICAgdmFsdWUgPSBzZWxmLmhlcm9Sb2xlLmF0dGFjayh2YWx1ZSk7XG4gICAgICAgICAgICAvL1xuICAgICAgICAgICAgdGhpcy5zaWRlVW5kZXJBdHRhY2soc2VsZi5lbmVteVJvbGUsbnVsbCxudWxsLHZhbHVlKTtcbiAgICAgICAgICAgIC8v54q25oCB6LCD5pW05oiW6ZmE5YqgXG4gICAgICAgICAgICBsZXQgbGl2ZT1zZWxmLmVuZW15Um9sZS5pc0FsaXZlKCk7XG4gICAgICAgICAgICBzZWxmLmN1cnJlbnRDYXJkLm5vZGUuZGVzdHJveSgpO1xuICAgICAgICAgICAgc2VsZi5jdXJyZW50Q2FyZCA9IG51bGw7XG4gICAgICAgICAgICBpZighbGl2ZSl7XG4gICAgICAgICAgICAgICAgc2VsZi5yb3VuZFNpZGU9LTE7XG4gICAgICAgICAgICAgICAgc2VsZi5hcHBlbmRMb2coXCLmlYzkurrmrbvkuqEg5ri45oiP6IOc5YipXCIpO1xuICAgICAgICAgICAgICAgIHNlbGYudG9NYXBTY2VuZSgpO1xuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH0sXG4gICAgLyoq5YWI5Yik5a6a55uu5qCHXG4gICAgICog5qC55o2u54q25oCB5om/5Y+X5Lyk5a6zXG4gICAgICog5a6d5a6d5q275Lqh5pe26ZSA5q+B6IqC54K5XG4gICAgICovXG4gICAgc2lkZVVuZGVyQXR0YWNrOmZ1bmN0aW9uKHJvbGUscG9rZW1vbmxlZnQscG9rZW5tb25yaWdodCx2YWx1ZSl7XG5cbiAgICB9LFxuXG4gICAgc2VuZEZvY3VzU2hvdzpmdW5jdGlvbiAoY2FyZEJlYW4pIHtcbiAgICAgICAgc2VsZi5hcHBlbmRMb2coXCLlh7rniYxcIitjYXJkQmVhbi50aXRsZSk7XG4gICAgfSxcbiAgICByb3VuZE92ZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYoc2VsZi5yb3VuZFNpZGUhPT0xKXsvL+aVjOaWueWbnuWQiCDog5zliKkg5LiN6IO95Ye654mMXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc2VsZi5hcHBlbmRMb2coXCLlm57lkIjnu5PmnZ9cIik7XG4gICAgICAgIHRoaXMucm91bmRQcm9ncmFtKDApO1xuICAgIH0sXG4gICAgZ2FtZUVuY291bnRlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICBsZXQgaGVybyA9IG5ldyBSb2xlQmVhbigxKTtcbiAgICAgICAgbGV0IGVuZW15ID0gbmV3IFJvbGVCZWFuKDApO1xuICAgICAgICB0aGlzLmVuZW15Um9sZSA9IHRoaXMuZW5lbXkuZ2V0Q29tcG9uZW50KCdSb2xlJyk7XG4gICAgICAgIHRoaXMuZW5lbXlSb2xlLmJpbmRSb2xlQmVhbihlbmVteSk7XG5cbiAgICAgICAgdGhpcy5oZXJvUm9sZSA9IHRoaXMuaGVyby5nZXRDb21wb25lbnQoJ1JvbGUnKTtcbiAgICAgICAgdGhpcy5oZXJvUm9sZS5iaW5kUm9sZUJlYW4oaGVybyk7XG5cbiAgICAgICAgdGhpcy5zY2hlZHVsZU9uY2UoKCkgPT4gdGhpcy5yb3VuZFByb2dyYW0oMSksIDEpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICog5q+P5Zue5ZCI55qE5omn6KGM6aG65bqPXG4gICAgICovXG4gICAgcm91bmRQcm9ncmFtOiBmdW5jdGlvbiAocm9sZXR0eXBlKSB7XG4gICAgICAgIGxldCBudW1iZXI9MDtcbiAgICAgICAgdGhpcy5yb3VuZFNpZGU9cm9sZXR0eXBlO1xuICAgICAgICBpZiAocm9sZXR0eXBlID09PSAxKSB7XG4gICAgICAgICAgICBzZWxmLmFwcGVuZExvZyhcIuS9oOeahOWbnuWQiFwiKVxuICAgICAgICAgICAgdGhpcy5yb3VuZENvdW50Kys7XG4gICAgICAgICAgICAgdGhpcy5oZXJvUm9sZS5yb3VuZEJlZ2luKCk7XG4gICAgICAgICAgICAgbnVtYmVyPXNlbGYuY2FyZEFycmF5cy5ub2RlLmNoaWxkcmVuQ291bnQ7XG4gICAgICAgICAgICAvL+aKveWNoeebtOWIsOaJi+eJjOaKvea7oVxuICAgICAgICAgICAgc2VsZi5hcHBlbmRMb2coXCLkvaDmir3niYxcIilcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdG90YWxDYXJkTnVtLW51bWJlcjsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kcmF3Q2FyZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy/nrYnlvoXlh7rniYxcbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgc2VsZi5hcHBlbmRMb2coXCLlr7nmlrnlm57lkIhcIilcbiAgICAgICAgICAgIHRoaXMuZW5lbXlSb2xlLnJvdW5kQmVnaW4oKTtcbiAgICAgICAgICAgIG51bWJlcj1zZWxmLmVuZW15Q2FyZEFycmF5cy5sZW5ndGg7XG4gICAgICAgICAgICBzZWxmLmFwcGVuZExvZyhcIuWvueaWueaKveeJjFwiKVxuICAgICAgICAgICAgLy/osIPnlKhhaeaKveeJjFxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3RhbENhcmROdW0tbnVtYmVyOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdBSUNhcmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuZW5lbXlDYXJkTGFiZWwuc3RyaW5nPXNlbGYuZW5lbXlDYXJkQXJyYXlzLmxlbmd0aCtcIuW8oFwiO1xuICAgICAgICAgICAgdGhpcy5sb2dpY0FJKCk7XG5cbiAgICAgICAgfVxuXG5cbiAgICB9LFxuICAgIC8vQUnlh7rniYzpgLvovpFcbiAgICBsb2dpY0FJKCl7XG4gICAgICAgIGZvcihsZXQgaT0wO2k8c2VsZi5lbmVteUNhcmRBcnJheXMubGVuZ3RoOyl7XG4gICAgICAgICAgICBsZXQgY2FyZEJlYW49c2VsZi5lbmVteUNhcmRBcnJheXNbaV07XG4gICAgICAgICAgICBsZXQgY2FuU2VuZD10cnVlO1xuICAgICAgICAgICAgaWYoY2FuU2VuZCl7XG4gICAgICAgICAgICAgICAgc2VsZi5lbmVteUNhcmRBcnJheXMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIGxldCB2YWx1ZT1jYXJkQmVhbi5zZW5kRWZmZWN0KCk7XG4gICAgICAgICAgICAgICAgdmFsdWU9c2VsZi5lbmVteVJvbGUuYXR0YWNrKHZhbHVlKTtcbiAgICAgICAgICAgICAgICBzZWxmLmFwcGVuZExvZyhcIuS9oOWPl+WIsOS8pOWus1wiK3ZhbHVlKTtcbiAgICAgICAgICAgICAgICBzZWxmLnNlbmRGb2N1c1Nob3coY2FyZEJlYW4pO1xuICAgICAgICAgICAgICAgIGxldCBsaXZlPXNlbGYuaGVyb1JvbGUudW5kZXJhdHRhY2sodmFsdWUpO1xuICAgICAgICAgICAgICAgIGlmKCFsaXZlKXtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5hcHBlbmRMb2coXCLoi7Hpm4TmrbvkuqEg5ri45oiP57uT5p2fXCIpO1xuICAgICAgICAgICAgICAgICAgICBzZWxmLnJvdW5kU2lkZT0tMTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLmVuZW15Q2FyZExhYmVsLnN0cmluZz1zZWxmLmVuZW15Q2FyZEFycmF5cy5sZW5ndGgrXCLlvKBcIjtcbiAgICAgICAgICAgICAgICBzZWxmLnNjaGVkdWxlT25jZSgoKSA9PiBzZWxmLmxvZ2ljQUkoKSwgMSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgICAgIHNlbGYuZW5lbXlSb2xlLnJvdW5kT3ZlcigpO1xuICAgICAgICBzZWxmLnJvdW5kUHJvZ3JhbSgxKTtcbiAgICB9LFxuXG4vLyAgICAgbW92ZTpmdW5jdGlvbihub2RlLGRpc3RhbmNlKXtcbi8vICAgICAgICAgLy8g5Yib5bu65LiA5Liq56e75Yqo5Yqo5L2cXG4vLyAgICAgICAgIGxldCBzZXEgPSBjYy5yZXBlYXQoXG4vLyAgICAgICAgICAgICBjYy5zZXF1ZW5jZShcbi8vICAgICAgICAgICAgICAgICBjYy5tb3ZlQnkoMiwgIC1kaXN0YW5jZSwgNTApLFxuLy8gICAgICAgICAgICAgICAgIGNjLm1vdmVCeSgyLGRpc3RhbmNlLCAtNTApXG4vLyAgICAgICAgICAgICApLCAyKTtcbi8vXG4vL1xuLy8gLy8g5omn6KGM5Yqo5L2cXG4vLyAgICAgICAgIG5vZGUucnVuQWN0aW9uKHNlcSk7XG4vLyAvLyDlgZzmraLkuIDkuKrliqjkvZxcbi8vIC8vICAgICAgICAgbm9kZS5zdG9wQWN0aW9uKGFjdGlvbik7XG4vLyAgICAgfSxcbiAgICAvKipcbiAgICAgKiDliIfmjaLoh7PlnLDlm75cbiAgICAgKi9cbiAgICB0b01hcFNjZW5lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc2F2ZUhlcm9EYXRhKCk7XG4gICAgICAgIERpcmVjdG9yLmN1cnJlbnRFbmVteT1udWxsO1xuICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoJ291dGVybWFwJyk7XG5cbiAgICB9LFxuICAgIHNhdmVIZXJvRGF0YTpmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmKHNlbGYuaGVyb1JvbGUucm9sZUhwPD1EaXJlY3Rvci5ob3N0SGVyby5mdWxsaHApe1xuICAgICAgICAgICAgRGlyZWN0b3IuaG9zdEhlcm8uaHA9c2VsZi5oZXJvUm9sZS5yb2xlSHA7XG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIERpcmVjdG9yLmhvc3RIZXJvLmhwPURpcmVjdG9yLmhvc3RIZXJvLmZ1bGxocDtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgYXBwZW5kTG9nOiBmdW5jdGlvbiAoc3RyaW5nKSB7XG4gICAgICAgIHNlbGYucGxheUxvZyA9IHNlbGYucGxheUxvZyArIFwiXFxuXCIgKyBzdHJpbmc7XG4gICAgICAgIHNlbGYubG9ncy5zdHJpbmcgPSBzZWxmLnBsYXlMb2c7XG5cbiAgICB9XG5cbn0pO1xuIl19