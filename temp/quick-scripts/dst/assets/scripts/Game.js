
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Game.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '4e12fLSQu1L+KV6QmxDiavU', 'Game');
// scripts/Game.js

"use strict";

exports.__esModule = true;
exports.StatusType = void 0;

var _CardBean = _interopRequireDefault(require("./beans/CardBean"));

var _RoleBean = _interopRequireDefault(require("./beans/RoleBean"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var PokerUtil = require("PokerUtil");

var AIHelper = require("AIHelper");

var self;
var StatusType = {
  ENCOUNTER: 0,
  //遭遇
  ROUNDBEGIN: 1,
  //回合开始
  ROUNDOVER: -1,
  //回合结束
  CLEAR: -2,
  //战斗结束
  DRAW: 2,
  SEND: 3,
  //出牌
  LOSE: 4,
  //弃牌
  ATTACK: 5,
  //攻击时触发
  UNDERATTACK: 6 //被攻击时触发

};
exports.StatusType = StatusType;
var totalCardNum = 5;
/**
 * 战斗界面 demo版本，做一个抽卡，每张卡能打3点血，敌方有20点血的demo
 */

cc.Class({
  "extends": cc.Component,
  properties: {
    logs: {
      "default": null,
      type: cc.Label
    },
    menuView: {
      "default": null,
      type: cc.Button
    },
    coinValueView: {
      "default": null,
      type: cc.Label
    },
    cardPrefab: {
      "default": null,
      type: cc.Prefab
    },
    cardArrays: {
      "default": null,
      type: cc.Layout
    },
    sendBtn: {
      "default": null,
      type: cc.Button
    },
    roundOverBtn: {
      "default": null,
      type: cc.Button
    },
    roundType: StatusType.ROUNDBEGIN,
    hero: {
      "default": null,
      type: cc.Node
    },
    enemy: {
      "default": null,
      type: cc.Node
    },
    enemyCardLabel: {
      "default": null,
      type: cc.Label
    },
    currentCard: null,
    //玩家当前选中的卡片
    enemyCardArrays: [],
    //敌人卡牌
    roundSide: 1,
    //回合轮次
    roundCount: 0
  },
  onLoad: function onLoad() {
    self = this;
    this.playLog = "游戏开始";
    this.roundOverBtn.node.on("click", this.roundOver, this);
    this.sendBtn.node.on("click", this.sendCard, this);
    this.gameEncounter(); // 这里的 this 指向 component
  },
  drawAICard: function drawAICard() {
    var cardBean = new _CardBean["default"]();
    self.enemyRole.onDrawCard(cardBean);
    self.enemyCardArrays.push(cardBean);
  },
  //玩家抽牌
  drawCard: function drawCard() {
    var newCard = cc.instantiate(self.cardPrefab); // newStar.setPicNum("i"+i);

    var card = newCard.getComponent('Card');
    var cardBean = new _CardBean["default"]();
    self.heroRole.onDrawCard(cardBean);
    card.bindCardBean(cardBean);
    card.bindCardFunction(this.onCheck);
    self.cardArrays.node.addChild(newCard);
  },
  onCheck: function onCheck(card, isCheck) {
    if (isCheck) {
      //选中
      if (self.currentCard != null) {
        self.currentCard.onCancel();
      }

      self.currentCard = card;
    } else {
      self.currentCard = null;
    }
  },

  /**
   * 判断牌是否能出
   * 判断知否是指向性牌
   *
   */
  sendCard: function sendCard() {
    if (self.roundSide !== 1) {
      //敌方回合 胜利 不能出牌
      return;
    }

    if (self.currentCard != null) {
      var card = self.currentCard.node.getComponent("Card");
      var cardBean = card.getCardBean();
      self.sendFocusShow(cardBean);
      var value = cardBean.sendEffect(); //造成的伤害值

      self.appendLog("对方受到伤害" + value); //攻击时的伤害值加强

      value = self.heroRole.attack(value); //状态调整或附加

      var live = self.enemyRole.underattack(value);
      self.currentCard.node.destroy();
      self.currentCard = null;

      if (!live) {
        self.roundSide = -1;
        self.appendLog("敌人死亡 游戏胜利");
      }
    }
  },
  sendFocusShow: function sendFocusShow(cardBean) {
    self.appendLog("出牌" + cardBean.title);
  },
  roundOver: function roundOver() {
    if (self.roundSide !== 1) {
      //敌方回合 胜利 不能出牌
      return;
    }

    self.appendLog("回合结束");
    this.roundProgram(0);
  },
  gameEncounter: function gameEncounter() {
    var _this = this;

    var hero = new _RoleBean["default"](1);
    var enemy = new _RoleBean["default"](0);
    this.enemyRole = this.enemy.getComponent('Role');
    this.enemyRole.bindRoleBean(enemy);
    this.heroRole = this.hero.getComponent('Role');
    this.heroRole.bindRoleBean(hero);
    this.scheduleOnce(function () {
      return _this.roundProgram(1);
    }, 1);
  },

  /**
   * 每回合的执行顺序
   */
  roundProgram: function roundProgram(rolettype) {
    var number = 0;
    this.roundSide = rolettype;

    if (rolettype === 1) {
      self.appendLog("你的回合");
      this.roundCount++;
      this.heroRole.roundBegin();
      number = self.cardArrays.node.childrenCount; //抽卡直到手牌抽满

      self.appendLog("你抽牌");

      for (var i = 0; i < totalCardNum - number; i++) {
        this.drawCard();
      } //等待出牌

    } else {
      self.appendLog("对方回合");
      this.enemyRole.roundBegin();
      number = self.enemyCardArrays.length;
      self.appendLog("对方抽牌"); //调用ai抽牌

      for (var _i = 0; _i < totalCardNum - number; _i++) {
        this.drawAICard();
      }

      this.enemyCardLabel.string = self.enemyCardArrays.length + "张";
      this.logicAI();
    }
  },
  //AI出牌逻辑
  logicAI: function logicAI() {
    for (var i = 0; i < self.enemyCardArrays.length;) {
      var cardBean = self.enemyCardArrays[i];
      var canSend = true;

      if (canSend) {
        self.enemyCardArrays.splice(i, 1);
        var value = cardBean.sendEffect();
        value = self.enemyRole.attack(value);
        self.appendLog("你受到伤害" + value);
        self.sendFocusShow(cardBean);
        var live = self.heroRole.underattack(value);

        if (!live) {
          self.appendLog("英雄死亡 游戏结束");
          self.roundSide = -1;
          return;
        }

        this.enemyCardLabel.string = self.enemyCardArrays.length + "张";
        self.scheduleOnce(function () {
          return self.logicAI();
        }, 1);
        return;
      } else {
        i++;
      }
    }

    self.enemyRole.roundOver();
    self.roundProgram(1);
  },
  //     move:function(node,distance){
  //         // 创建一个移动动作
  //         let seq = cc.repeat(
  //             cc.sequence(
  //                 cc.moveBy(2,  -distance, 50),
  //                 cc.moveBy(2,distance, -50)
  //             ), 2);
  //
  //
  // // 执行动作
  //         node.runAction(seq);
  // // 停止一个动作
  // //         node.stopAction(action);
  //     },

  /**
   * 切换至地图
   */
  outerClick: function outerClick() {
    cc.director.loadScene('outermap');
  },
  appendLog: function appendLog(string) {
    self.playLog = self.playLog + "\n" + string;
    self.logs.string = self.playLog;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL0dhbWUuanMiXSwibmFtZXMiOlsiUG9rZXJVdGlsIiwicmVxdWlyZSIsIkFJSGVscGVyIiwic2VsZiIsIlN0YXR1c1R5cGUiLCJFTkNPVU5URVIiLCJST1VOREJFR0lOIiwiUk9VTkRPVkVSIiwiQ0xFQVIiLCJEUkFXIiwiU0VORCIsIkxPU0UiLCJBVFRBQ0siLCJVTkRFUkFUVEFDSyIsInRvdGFsQ2FyZE51bSIsImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwibG9ncyIsInR5cGUiLCJMYWJlbCIsIm1lbnVWaWV3IiwiQnV0dG9uIiwiY29pblZhbHVlVmlldyIsImNhcmRQcmVmYWIiLCJQcmVmYWIiLCJjYXJkQXJyYXlzIiwiTGF5b3V0Iiwic2VuZEJ0biIsInJvdW5kT3ZlckJ0biIsInJvdW5kVHlwZSIsImhlcm8iLCJOb2RlIiwiZW5lbXkiLCJlbmVteUNhcmRMYWJlbCIsImN1cnJlbnRDYXJkIiwiZW5lbXlDYXJkQXJyYXlzIiwicm91bmRTaWRlIiwicm91bmRDb3VudCIsIm9uTG9hZCIsInBsYXlMb2ciLCJub2RlIiwib24iLCJyb3VuZE92ZXIiLCJzZW5kQ2FyZCIsImdhbWVFbmNvdW50ZXIiLCJkcmF3QUlDYXJkIiwiY2FyZEJlYW4iLCJDYXJkQmVhbiIsImVuZW15Um9sZSIsIm9uRHJhd0NhcmQiLCJwdXNoIiwiZHJhd0NhcmQiLCJuZXdDYXJkIiwiaW5zdGFudGlhdGUiLCJjYXJkIiwiZ2V0Q29tcG9uZW50IiwiaGVyb1JvbGUiLCJiaW5kQ2FyZEJlYW4iLCJiaW5kQ2FyZEZ1bmN0aW9uIiwib25DaGVjayIsImFkZENoaWxkIiwiaXNDaGVjayIsIm9uQ2FuY2VsIiwiZ2V0Q2FyZEJlYW4iLCJzZW5kRm9jdXNTaG93IiwidmFsdWUiLCJzZW5kRWZmZWN0IiwiYXBwZW5kTG9nIiwiYXR0YWNrIiwibGl2ZSIsInVuZGVyYXR0YWNrIiwiZGVzdHJveSIsInRpdGxlIiwicm91bmRQcm9ncmFtIiwiUm9sZUJlYW4iLCJiaW5kUm9sZUJlYW4iLCJzY2hlZHVsZU9uY2UiLCJyb2xldHR5cGUiLCJudW1iZXIiLCJyb3VuZEJlZ2luIiwiY2hpbGRyZW5Db3VudCIsImkiLCJsZW5ndGgiLCJzdHJpbmciLCJsb2dpY0FJIiwiY2FuU2VuZCIsInNwbGljZSIsIm91dGVyQ2xpY2siLCJkaXJlY3RvciIsImxvYWRTY2VuZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7OztBQUVBLElBQUlBLFNBQVMsR0FBR0MsT0FBTyxDQUFDLFdBQUQsQ0FBdkI7O0FBQ0EsSUFBSUMsUUFBUSxHQUFHRCxPQUFPLENBQUMsVUFBRCxDQUF0Qjs7QUFDQSxJQUFJRSxJQUFKO0FBQ08sSUFBSUMsVUFBVSxHQUFHO0FBQ3BCQyxFQUFBQSxTQUFTLEVBQUUsQ0FEUztBQUNQO0FBQ2JDLEVBQUFBLFVBQVUsRUFBRSxDQUZRO0FBRU47QUFDZEMsRUFBQUEsU0FBUyxFQUFFLENBQUMsQ0FIUTtBQUdOO0FBQ2RDLEVBQUFBLEtBQUssRUFBRSxDQUFDLENBSlk7QUFJVjtBQUNWQyxFQUFBQSxJQUFJLEVBQUMsQ0FMZTtBQU1wQkMsRUFBQUEsSUFBSSxFQUFFLENBTmM7QUFNWjtBQUNSQyxFQUFBQSxJQUFJLEVBQUUsQ0FQYztBQU9aO0FBQ1JDLEVBQUFBLE1BQU0sRUFBRSxDQVJZO0FBUVY7QUFDVkMsRUFBQUEsV0FBVyxFQUFFLENBVE8sQ0FTTDs7QUFUSyxDQUFqQjs7QUFXUCxJQUFJQyxZQUFZLEdBQUcsQ0FBbkI7QUFDQTs7OztBQUdBQyxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUU7QUFDUkMsSUFBQUEsSUFBSSxFQUFDO0FBQ0QsaUJBQVEsSUFEUDtBQUVEQyxNQUFBQSxJQUFJLEVBQUNMLEVBQUUsQ0FBQ007QUFGUCxLQURHO0FBTVJDLElBQUFBLFFBQVEsRUFBRTtBQUNOLGlCQUFTLElBREg7QUFFTkYsTUFBQUEsSUFB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O0FBQUEsU0FBbEIsRUFBd0MsQ0FBeEM7QUFDQTtBQUNILE9BZkQsTUFlTTtBQUNGSCxRQUFBQSxDQUFDO0FBQ0o7QUFFSjs7QUFDRGhGLElBQUFBLElBQUksQ0FBQytDLFNBQUwsQ0FBZU4sU0FBZjtBQUNBekMsSUFBQUEsSUFBSSxDQUFDd0UsWUFBTCxDQUFrQixDQUFsQjtBQUNILEdBMU1JO0FBNE1UO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBQ0k7OztBQUdBYyxFQUFBQSxVQUFVLEVBQUUsc0JBQVk7QUFDcEIxRSxJQUFBQSxFQUFFLENBQUMyRSxRQUFILENBQVlDLFNBQVosQ0FBc0IsVUFBdEI7QUFFSCxHQWhPSTtBQWlPTHRCLEVBQUFBLFNBQVMsRUFBRSxtQkFBVWdCLE1BQVYsRUFBa0I7QUFDekJsRixJQUFBQSxJQUFJLENBQUNzQyxPQUFMLEdBQWV0QyxJQUFJLENBQUNzQyxPQUFMLEdBQWUsSUFBZixHQUFzQjRDLE1BQXJDO0FBQ0FsRixJQUFBQSxJQUFJLENBQUNnQixJQUFMLENBQVVrRSxNQUFWLEdBQW1CbEYsSUFBSSxDQUFDc0MsT0FBeEI7QUFFSDtBQXJPSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ2FyZEJlYW4gZnJvbSBcIi4vYmVhbnMvQ2FyZEJlYW5cIjtcbmltcG9ydCBSb2xlQmVhbiBmcm9tIFwiLi9iZWFucy9Sb2xlQmVhblwiO1xuXG5sZXQgUG9rZXJVdGlsID0gcmVxdWlyZShcIlBva2VyVXRpbFwiKTtcbmxldCBBSUhlbHBlciA9IHJlcXVpcmUoXCJBSUhlbHBlclwiKTtcbmxldCBzZWxmO1xuZXhwb3J0IHZhciBTdGF0dXNUeXBlID0ge1xuICAgIEVOQ09VTlRFUjogMCwvL+mBremBh1xuICAgIFJPVU5EQkVHSU46IDEsLy/lm57lkIjlvIDlp4tcbiAgICBST1VORE9WRVI6IC0xLC8v5Zue5ZCI57uT5p2fXG4gICAgQ0xFQVI6IC0yLC8v5oiY5paX57uT5p2fXG4gICAgRFJBVzoyLFxuICAgIFNFTkQ6IDMsLy/lh7rniYxcbiAgICBMT1NFOiA0LC8v5byD54mMXG4gICAgQVRUQUNLOiA1LC8v5pS75Ye75pe26Kem5Y+RXG4gICAgVU5ERVJBVFRBQ0s6IDYsLy/ooqvmlLvlh7vml7bop6blj5Fcbn1cbmxldCB0b3RhbENhcmROdW0gPSA1O1xuLyoqXG4gKiDmiJjmlpfnlYzpnaIgZGVtb+eJiOacrO+8jOWBmuS4gOS4quaKveWNoe+8jOavj+W8oOWNoeiDveaJkzPngrnooYDvvIzmlYzmlrnmnIkyMOeCueihgOeahGRlbW9cbiAqL1xuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcblxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgbG9nczp7XG4gICAgICAgICAgICBkZWZhdWx0Om51bGwsXG4gICAgICAgICAgICB0eXBlOmNjLkxhYmVsLFxuICAgICAgICB9LFxuXG4gICAgICAgIG1lbnVWaWV3OiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuQnV0dG9uLFxuICAgICAgICB9LFxuICAgICAgICBjb2luVmFsdWVWaWV3OiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuTGFiZWwsXG4gICAgICAgIH0sXG4gICAgICAgIGNhcmRQcmVmYWI6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5QcmVmYWJcbiAgICAgICAgfSxcbiAgICAgICAgY2FyZEFycmF5czoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLkxheW91dCxcbiAgICAgICAgfSxcbiAgICAgICAgc2VuZEJ0bjoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLkJ1dHRvbixcbiAgICAgICAgfSxcbiAgICAgICAgcm91bmRPdmVyQnRuOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuQnV0dG9uLFxuICAgICAgICB9LFxuICAgICAgICByb3VuZFR5cGU6IFN0YXR1c1R5cGUuUk9VTkRCRUdJTixcbiAgICAgICAgaGVybzoge1xuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCxcbiAgICAgICAgICAgIHR5cGU6IGNjLk5vZGVcbiAgICAgICAgfSxcbiAgICAgICAgZW5lbXk6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IG51bGwsXG4gICAgICAgICAgICB0eXBlOiBjYy5Ob2RlXG4gICAgICAgIH0sXG4gICAgICAgIGVuZW15Q2FyZExhYmVsOiB7XG4gICAgICAgICAgICBkZWZhdWx0OiBudWxsLFxuICAgICAgICAgICAgdHlwZTogY2MuTGFiZWwsXG4gICAgICAgIH0sXG5cbiAgICAgICAgY3VycmVudENhcmQ6IG51bGwsLy/njqnlrrblvZPliY3pgInkuK3nmoTljaHniYdcbiAgICAgICAgZW5lbXlDYXJkQXJyYXlzOltdLC8v5pWM5Lq65Y2h54mMXG4gICAgICAgIHJvdW5kU2lkZToxLC8v5Zue5ZCI6L2u5qyhXG4gICAgICAgIHJvdW5kQ291bnQ6MCxcblxuXG4gICAgfSxcblxuICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5wbGF5TG9nPVwi5ri45oiP5byA5aeLXCI7XG4gICAgICAgIHRoaXMucm91bmRPdmVyQnRuLm5vZGUub24oXCJjbGlja1wiLCB0aGlzLnJvdW5kT3ZlciwgdGhpcyk7XG4gICAgICAgIHRoaXMuc2VuZEJ0bi5ub2RlLm9uKFwiY2xpY2tcIiwgdGhpcy5zZW5kQ2FyZCwgdGhpcyk7XG4gICAgICAgIHRoaXMuZ2FtZUVuY291bnRlcigpO1xuICAgICAgICAvLyDov5nph4znmoQgdGhpcyDmjIflkJEgY29tcG9uZW50XG4gICAgfSxcbiAgICBkcmF3QUlDYXJkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBjYXJkQmVhbj1uZXcgQ2FyZEJlYW4oKTtcbiAgICAgICAgc2VsZi5lbmVteVJvbGUub25EcmF3Q2FyZChjYXJkQmVhbik7XG4gICAgICAgIHNlbGYuZW5lbXlDYXJkQXJyYXlzLnB1c2goY2FyZEJlYW4pO1xuXG4gICAgfSxcbiAgICAvL+eOqeWutuaKveeJjFxuICAgIGRyYXdDYXJkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBuZXdDYXJkID0gY2MuaW5zdGFudGlhdGUoc2VsZi5jYXJkUHJlZmFiKTtcbiAgICAgICAgLy8gbmV3U3Rhci5zZXRQaWNOdW0oXCJpXCIraSk7XG5cbiAgICAgICAgbGV0IGNhcmQgPSBuZXdDYXJkLmdldENvbXBvbmVudCgnQ2FyZCcpO1xuICAgICAgICBsZXQgY2FyZEJlYW49bmV3IENhcmRCZWFuKCk7XG4gICAgICAgIHNlbGYuaGVyb1JvbGUub25EcmF3Q2FyZChjYXJkQmVhbik7XG4gICAgICAgIGNhcmQuYmluZENhcmRCZWFuKGNhcmRCZWFuKTtcbiAgICAgICAgY2FyZC5iaW5kQ2FyZEZ1bmN0aW9uKHRoaXMub25DaGVjayk7XG4gICAgICAgIHNlbGYuY2FyZEFycmF5cy5ub2RlLmFkZENoaWxkKG5ld0NhcmQpO1xuICAgIH0sXG4gICAgb25DaGVjazogZnVuY3Rpb24gKGNhcmQsIGlzQ2hlY2spIHtcbiAgICAgICAgaWYgKGlzQ2hlY2spIHsvL+mAieS4rVxuICAgICAgICAgICAgaWYgKHNlbGYuY3VycmVudENhcmQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHNlbGYuY3VycmVudENhcmQub25DYW5jZWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHNlbGYuY3VycmVudENhcmQgPSBjYXJkO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2VsZi5jdXJyZW50Q2FyZCA9IG51bGw7XG4gICAgICAgIH1cblxuICAgIH0sXG4gICAgLyoqXG4gICAgICog5Yik5pat54mM5piv5ZCm6IO95Ye6XG4gICAgICog5Yik5pat55+l5ZCm5piv5oyH5ZCR5oCn54mMXG4gICAgICpcbiAgICAgKi9cbiAgICBzZW5kQ2FyZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZihzZWxmLnJvdW5kU2lkZSE9PTEpey8v5pWM5pa55Zue5ZCIIOiDnOWIqSDkuI3og73lh7rniYxcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2VsZi5jdXJyZW50Q2FyZCAhPSBudWxsKSB7XG4gICAgICAgICAgICBsZXQgY2FyZCA9IHNlbGYuY3VycmVudENhcmQubm9kZS5nZXRDb21wb25lbnQoXCJDYXJkXCIpO1xuICAgICAgICAgICAgbGV0IGNhcmRCZWFuPWNhcmQuZ2V0Q2FyZEJlYW4oKTtcbiAgICAgICAgICAgIHNlbGYuc2VuZEZvY3VzU2hvdyhjYXJkQmVhbik7XG4gICAgICAgICAgICBsZXQgdmFsdWUgPSBjYXJkQmVhbi5zZW5kRWZmZWN0KCk7Ly/pgKDmiJDnmoTkvKTlrrPlgLxcbiAgICAgICAgICAgIHNlbGYuYXBwZW5kTG9nKFwi5a+55pa55Y+X5Yiw5Lyk5a6zXCIrdmFsdWUpO1xuICAgICAgICAgICAgLy/mlLvlh7vml7bnmoTkvKTlrrPlgLzliqDlvLpcbiAgICAgICAgICAgIHZhbHVlID0gc2VsZi5oZXJvUm9sZS5hdHRhY2sodmFsdWUpO1xuICAgICAgICAgICAgLy/nirbmgIHosIPmlbTmiJbpmYTliqBcbiAgICAgICAgICAgIGxldCBsaXZlPXNlbGYuZW5lbXlSb2xlLnVuZGVyYXR0YWNrKHZhbHVlKTtcbiAgICAgICAgICAgIHNlbGYuY3VycmVudENhcmQubm9kZS5kZXN0cm95KCk7XG4gICAgICAgICAgICBzZWxmLmN1cnJlbnRDYXJkID0gbnVsbDtcbiAgICAgICAgICAgIGlmKCFsaXZlKXtcbiAgICAgICAgICAgICAgICBzZWxmLnJvdW5kU2lkZT0tMTtcbiAgICAgICAgICAgICAgICBzZWxmLmFwcGVuZExvZyhcIuaVjOS6uuatu+S6oSDmuLjmiI/og5zliKlcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH0sXG5cbiAgICBzZW5kRm9jdXNTaG93OmZ1bmN0aW9uIChjYXJkQmVhbikge1xuICAgICAgICBzZWxmLmFwcGVuZExvZyhcIuWHuueJjFwiK2NhcmRCZWFuLnRpdGxlKTtcbiAgICB9LFxuICAgIHJvdW5kT3ZlcjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZihzZWxmLnJvdW5kU2lkZSE9PTEpey8v5pWM5pa55Zue5ZCIIOiDnOWIqSDkuI3og73lh7rniYxcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBzZWxmLmFwcGVuZExvZyhcIuWbnuWQiOe7k+adn1wiKTtcbiAgICAgICAgdGhpcy5yb3VuZFByb2dyYW0oMCk7XG4gICAgfSxcbiAgICBnYW1lRW5jb3VudGVyOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGxldCBoZXJvID0gbmV3IFJvbGVCZWFuKDEpO1xuICAgICAgICBsZXQgZW5lbXkgPSBuZXcgUm9sZUJlYW4oMCk7XG4gICAgICAgIHRoaXMuZW5lbXlSb2xlID0gdGhpcy5lbmVteS5nZXRDb21wb25lbnQoJ1JvbGUnKTtcbiAgICAgICAgdGhpcy5lbmVteVJvbGUuYmluZFJvbGVCZWFuKGVuZW15KTtcblxuICAgICAgICB0aGlzLmhlcm9Sb2xlID0gdGhpcy5oZXJvLmdldENvbXBvbmVudCgnUm9sZScpO1xuICAgICAgICB0aGlzLmhlcm9Sb2xlLmJpbmRSb2xlQmVhbihoZXJvKTtcblxuICAgICAgICB0aGlzLnNjaGVkdWxlT25jZSgoKSA9PiB0aGlzLnJvdW5kUHJvZ3JhbSgxKSwgMSk7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDmr4/lm57lkIjnmoTmiafooYzpobrluo9cbiAgICAgKi9cbiAgICByb3VuZFByb2dyYW06IGZ1bmN0aW9uIChyb2xldHR5cGUpIHtcbiAgICAgICAgbGV0IG51bWJlcj0wO1xuICAgICAgICB0aGlzLnJvdW5kU2lkZT1yb2xldHR5cGU7XG4gICAgICAgIGlmIChyb2xldHR5cGUgPT09IDEpIHtcbiAgICAgICAgICAgIHNlbGYuYXBwZW5kTG9nKFwi5L2g55qE5Zue5ZCIXCIpXG4gICAgICAgICAgICB0aGlzLnJvdW5kQ291bnQrKztcbiAgICAgICAgICAgICB0aGlzLmhlcm9Sb2xlLnJvdW5kQmVnaW4oKTtcbiAgICAgICAgICAgICBudW1iZXI9c2VsZi5jYXJkQXJyYXlzLm5vZGUuY2hpbGRyZW5Db3VudDtcbiAgICAgICAgICAgIC8v5oq95Y2h55u05Yiw5omL54mM5oq95ruhXG4gICAgICAgICAgICBzZWxmLmFwcGVuZExvZyhcIuS9oOaKveeJjFwiKVxuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3RhbENhcmROdW0tbnVtYmVyOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmRyYXdDYXJkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL+etieW+heWHuueJjFxuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICBzZWxmLmFwcGVuZExvZyhcIuWvueaWueWbnuWQiFwiKVxuICAgICAgICAgICAgdGhpcy5lbmVteVJvbGUucm91bmRCZWdpbigpO1xuICAgICAgICAgICAgbnVtYmVyPXNlbGYuZW5lbXlDYXJkQXJyYXlzLmxlbmd0aDtcbiAgICAgICAgICAgIHNlbGYuYXBwZW5kTG9nKFwi5a+55pa55oq954mMXCIpXG4gICAgICAgICAgICAvL+iwg+eUqGFp5oq954mMXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRvdGFsQ2FyZE51bS1udW1iZXI7IGkrKykge1xuICAgICAgICAgICAgICAgIHRoaXMuZHJhd0FJQ2FyZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5lbmVteUNhcmRMYWJlbC5zdHJpbmc9c2VsZi5lbmVteUNhcmRBcnJheXMubGVuZ3RoK1wi5bygXCI7XG4gICAgICAgICAgICB0aGlzLmxvZ2ljQUkoKTtcblxuICAgICAgICB9XG5cblxuICAgIH0sXG4gICAgLy9BSeWHuueJjOmAu+i+kVxuICAgIGxvZ2ljQUkoKXtcbiAgICAgICAgZm9yKGxldCBpPTA7aTxzZWxmLmVuZW15Q2FyZEFycmF5cy5sZW5ndGg7KXtcbiAgICAgICAgICAgIGxldCBjYXJkQmVhbj1zZWxmLmVuZW15Q2FyZEFycmF5c1tpXTtcbiAgICAgICAgICAgIGxldCBjYW5TZW5kPXRydWU7XG4gICAgICAgICAgICBpZihjYW5TZW5kKXtcbiAgICAgICAgICAgICAgICBzZWxmLmVuZW15Q2FyZEFycmF5cy5zcGxpY2UoaSwgMSk7XG4gICAgICAgICAgICAgICAgbGV0IHZhbHVlPWNhcmRCZWFuLnNlbmRFZmZlY3QoKTtcbiAgICAgICAgICAgICAgICB2YWx1ZT1zZWxmLmVuZW15Um9sZS5hdHRhY2sodmFsdWUpO1xuICAgICAgICAgICAgICAgIHNlbGYuYXBwZW5kTG9nKFwi5L2g5Y+X5Yiw5Lyk5a6zXCIrdmFsdWUpO1xuICAgICAgICAgICAgICAgIHNlbGYuc2VuZEZvY3VzU2hvdyhjYXJkQmVhbik7XG4gICAgICAgICAgICAgICAgbGV0IGxpdmU9c2VsZi5oZXJvUm9sZS51bmRlcmF0dGFjayh2YWx1ZSk7XG4gICAgICAgICAgICAgICAgaWYoIWxpdmUpe1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmFwcGVuZExvZyhcIuiLsembhOatu+S6oSDmuLjmiI/nu5PmnZ9cIik7XG4gICAgICAgICAgICAgICAgICAgIHNlbGYucm91bmRTaWRlPS0xO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZW5lbXlDYXJkTGFiZWwuc3RyaW5nPXNlbGYuZW5lbXlDYXJkQXJyYXlzLmxlbmd0aCtcIuW8oFwiO1xuICAgICAgICAgICAgICAgIHNlbGYuc2NoZWR1bGVPbmNlKCgpID0+IHNlbGYubG9naWNBSSgpLCAxKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgICAgc2VsZi5lbmVteVJvbGUucm91bmRPdmVyKCk7XG4gICAgICAgIHNlbGYucm91bmRQcm9ncmFtKDEpO1xuICAgIH0sXG5cbi8vICAgICBtb3ZlOmZ1bmN0aW9uKG5vZGUsZGlzdGFuY2Upe1xuLy8gICAgICAgICAvLyDliJvlu7rkuIDkuKrnp7vliqjliqjkvZxcbi8vICAgICAgICAgbGV0IHNlcSA9IGNjLnJlcGVhdChcbi8vICAgICAgICAgICAgIGNjLnNlcXVlbmNlKFxuLy8gICAgICAgICAgICAgICAgIGNjLm1vdmVCeSgyLCAgLWRpc3RhbmNlLCA1MCksXG4vLyAgICAgICAgICAgICAgICAgY2MubW92ZUJ5KDIsZGlzdGFuY2UsIC01MClcbi8vICAgICAgICAgICAgICksIDIpO1xuLy9cbi8vXG4vLyAvLyDmiafooYzliqjkvZxcbi8vICAgICAgICAgbm9kZS5ydW5BY3Rpb24oc2VxKTtcbi8vIC8vIOWBnOatouS4gOS4quWKqOS9nFxuLy8gLy8gICAgICAgICBub2RlLnN0b3BBY3Rpb24oYWN0aW9uKTtcbi8vICAgICB9LFxuICAgIC8qKlxuICAgICAqIOWIh+aNouiHs+WcsOWbvlxuICAgICAqL1xuICAgIG91dGVyQ2xpY2s6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MuZGlyZWN0b3IubG9hZFNjZW5lKCdvdXRlcm1hcCcpO1xuXG4gICAgfSxcbiAgICBhcHBlbmRMb2c6IGZ1bmN0aW9uIChzdHJpbmcpIHtcbiAgICAgICAgc2VsZi5wbGF5TG9nID0gc2VsZi5wbGF5TG9nICsgXCJcXG5cIiArIHN0cmluZztcbiAgICAgICAgc2VsZi5sb2dzLnN0cmluZyA9IHNlbGYucGxheUxvZztcblxuICAgIH1cblxufSk7XG4iXX0=